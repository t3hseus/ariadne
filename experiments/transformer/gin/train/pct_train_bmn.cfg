import experiments.graph.data_loader
import experiments.graph.dataset

### experiment setup ###
experiment.model = @PCTSegment
experiment.criterion = @PerceiverFocalLoss
experiment.metrics = [
#    @transformer.precision,
#    @transformer.recall,
#    @transformer.f1_score,
    @transformer.true_acc,
    @transformer.fake_acc
]
experiment.optimizer = @Lamb
experiment.data_loader = @CloudDataLoader
experiment.epochs = 1000
experiment.fp16_training = False
experiment.random_seed = 42
experiment.num_gpus = 0


CloudDataLoader.dataset = @CloudDataset
CloudDataLoader.collate_fn = @voxel_collate_fn
CloudDataLoader.n_train = 10
CloudDataLoader.n_valid = 10
CloudDataLoader.batch_size = 1
# dataset
CloudDataset.input_dir = "D:/data/bmn"
CloudDataset.n_samples = 2

### model ###
Performer.n_feat = 3

HFPerceiver.d_latents = 256
HFPerceiver.d_model = 256
HFPerceiver.num_heads = 2
HFPerceiver.num_latents = 248

### loss ###
PerceiverFocalLoss.alpha = 0.25   # 0.5 / 0.1
PerceiverFocalLoss.gamma = 2   # 0.5 / 0.1
### optimizer ###
Lamb.lr = 0.0001
AdamW.lr = 0.0003
AdamW.weight_decay = 0.0001

# AdamW.weight_decay = 0.000001

cloud_collate_fn.shuffle = True
cloud_collate_fn.sample_len = 1024

voxel_collate_fn.shuffle = True
voxel_collate_fn.sample_len = 512
voxel_collate_fn.vx = 0.25
voxel_collate_fn.vy = 0.2
voxel_collate_fn.vz = 0.5
voxel_collate_fn.xrange=(-2.0, 2.0)
voxel_collate_fn.yrange=(-2.0, 2.0)
voxel_collate_fn.zrange=(-2.0, 2.0)

PCTSegment.n_points = 512
PCTSegment.input_channels = 6